--[[
    BLOX FRUITS MODERN HUB v3.0
    вњ… 2025+ Р’РµСЂСЃРёСЏ СЃ РЅРѕРІРѕР№ Р»РѕРіРёРєРѕР№
    вњ… Р”РёРЅР°РјРёС‡РµСЃРєРёР№ РїРѕРёСЃРє NPC
    вњ… РћР±С…РѕРґ Р°РЅС‚РёС‡РёС‚Р° (Р±РµР· BodyVelocity)
    вњ… РљСЂР°СЃРёРІС‹Р№ Modern UI
    вњ… Р Р°Р±РѕС‡РёР№ AutoFarm
]]

local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game.Workspace

local Player = Players.LocalPlayer
if not Player then error("вќЊ Failed to get LocalPlayer") end
Player.CharacterAdded:Wait()
wait(1)

--// THEME & COLORS
local Theme = {
    Primary = Color3.fromRGB(100, 200, 255),           -- Cyan
    Secondary = Color3.fromRGB(30, 30, 45),            -- Dark
    Accent = Color3.fromRGB(255, 100, 150),            -- Pink
    Background = Color3.fromRGB(15, 15, 25),           -- Very Dark
    Success = Color3.fromRGB(100, 255, 100),           -- Green
    Error = Color3.fromRGB(255, 100, 100),             -- Red
    Text = Color3.fromRGB(255, 255, 255),
    TextGray = Color3.fromRGB(150, 150, 150),
    Font = Enum.Font.GothamBold
}

--// CONFIG
local Config = {
    AutoFarm = false,
    AutoQuest = false,
    AutoAttack = false,
    ESP = false,
    Speed = 100,
    Debug = false
}

local Status = "Idle..."

--// DYNAMIC NPC FINDER
local function FindNPCs()
    local npcs = {}
    local npcFolder = Workspace:FindFirstChild("NPCFolder") or Workspace:FindFirstChild("NPCs")
    
    if npcFolder then
        for _, npc in pairs(npcFolder:GetDescendants()) do
            if npc:IsA("Model") and npc:FindFirstChild("HumanoidRootPart") then
                table.insert(npcs, npc)
            end
        end
    end
    return npcs
end

--// GET ENEMIES
local function GetEnemies()
    local enemies = {}
    local enemyFolder = Workspace:FindFirstChild("Enemies")
    
    if enemyFolder then
        for _, enemy in pairs(enemyFolder:GetChildren()) do
            if enemy:IsA("Model") and enemy:FindFirstChild("Humanoid") and enemy.Humanoid.Health > 0 then
                table.insert(enemies, enemy)
            end
        end
    end
    return enemies
end

--// FIND CLOSEST ENEMY
local function FindClosestEnemy()
    local enemies = GetEnemies()
    local closest = nil
    local closestDist = math.huge
    
    for _, enemy in pairs(enemies) do
        if enemy:FindFirstChild("HumanoidRootPart") then
            local dist = (Player.Character.HumanoidRootPart.Position - enemy.HumanoidRootPart.Position).Magnitude
            if dist < closestDist then
                closestDist = dist
                closest = enemy
            end
        end
    end
    return closest, closestDist
end

--// SMART MOVE (Anti-Anti-Cheat)
local function MoveTo(targetCF, speed)
    speed = speed or 100
    if not Player.Character or not Player.Character:FindFirstChild("HumanoidRootPart") then return end
    
    local hrp = Player.Character.HumanoidRootPart
    local distance = (hrp.Position - targetCF.Position).Magnitude
    local duration = math.max(distance / speed, 0.1)
    
    local tween = TweenService:Create(
        hrp,
        TweenInfo.new(duration, Enum.EasingStyle.Linear),
        {CFrame = targetCF}
    )
    tween:Play()
    return tween
end

--// AUTO ATTACK
local function Attack()
    if not Config.AutoAttack then return end
    
    local enemy, dist = FindClosestEnemy()
    if enemy and dist < 50 then
        if Player.Character:FindFirstChild("Humanoid") then
            Player.Character.Humanoid:MoveTo(enemy.HumanoidRootPart.Position)
        end
        
        -- Try to activate abilities
        pcall(function()
            for _, remote in pairs(ReplicatedStorage:GetDescendants()) do
                if (remote:IsA("RemoteFunction") or remote:IsA("RemoteEvent")) then
                    if remote.Name:lower():match("attack") or remote.Name:lower():match("ability") then
                        if remote:IsA("RemoteFunction") then remote:InvokeServer() else remote:FireServer() end
                        return
                    end
                end
            end
        end)
    end
end

--// UPDATE STATUS
local function SetStatus(text)
    Status = text
    if Config.Debug then print("[UI] " .. text) end
end

--// ===================== MODERN UI LIBRARY =====================
local UILib = {}

function UILib:CreateWindow(title)
    -- Remove old UI
    pcall(function() CoreGui:FindFirstChild("ModernHub"):Destroy() end)
    
    -- Screen GUI
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "ModernHub"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = CoreGui
    
    -- Protect from deletion
    game.DescendantRemoving:Connect(function(obj)
        if obj.Name == "ModernHub" then
            task.wait()
            pcall(function() obj:Clone().Parent = CoreGui end)
        end
    end)
    
    -- Open Button
    local toggleBtn = Instance.new("TextButton")
    toggleBtn.Name = "ToggleBtn"
    toggleBtn.Parent = screenGui
    toggleBtn.BackgroundColor3 = Theme.Primary
    toggleBtn.TextColor3 = Theme.Text
    toggleBtn.TextSize = 18
    toggleBtn.Font = Theme.Font
    toggleBtn.Position = UDim2.new(0, 20, 0.5, -20)
    toggleBtn.Size = UDim2.new(0, 40, 0, 40)
    toggleBtn.Text = "в—„в–є"
    toggleBtn.BorderSizePixel = 0
    
    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(0, 10)
    toggleCorner.Parent = toggleBtn
    
    -- Main Window
    local mainWindow = Instance.new("Frame")
    mainWindow.Name = "MainWindow"
    mainWindow.Parent = screenGui
    mainWindow.BackgroundColor3 = Theme.Background
    mainWindow.BorderSizePixel = 0
    mainWindow.Position = UDim2.new(0.5, -300, 0.5, -250)
    mainWindow.Size = UDim2.new(0, 600, 0, 500)
    mainWindow.Visible = false
    
    local mainCorner = Instance.new("UICorner")
    mainCorner.CornerRadius = UDim.new(0, 15)
    mainCorner.Parent = mainWindow
    
    local mainStroke = Instance.new("UIStroke")
    mainStroke.Color = Theme.Primary
    mainStroke.Thickness = 2
    mainStroke.Parent = mainWindow
    
    -- Title Bar
    local titleBar = Instance.new("Frame")
    titleBar.Parent = mainWindow
    titleBar.BackgroundColor3 = Theme.Primary
    titleBar.BorderSizePixel = 0
    titleBar.Size = UDim2.new(1, 0, 0, 50)
    
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 15)
    titleCorner.Parent = titleBar
    
    local titleText = Instance.new("TextLabel")
    titleText.Parent = titleBar
    titleText.BackgroundTransparency = 1
    titleText.TextColor3 = Theme.Text
    titleText.TextSize = 22
    titleText.Font = Theme.Font
    titleText.Text = "  " .. title
    titleText.TextXAlignment = Enum.TextXAlignment.Left
    titleText.Size = UDim2.new(1, -60, 1, 0)
    
    -- Close Button
    local closeBtn = Instance.new("TextButton")
    closeBtn.Parent = titleBar
    closeBtn.BackgroundColor3 = Theme.Error
    closeBtn.TextColor3 = Theme.Text
    closeBtn.TextSize = 16
    closeBtn.Font = Theme.Font
    closeBtn.Text = "вњ•"
    closeBtn.BorderSizePixel = 0
    closeBtn.Position = UDim2.new(1, -40, 0, 0)
    closeBtn.Size = UDim2.new(0, 40, 0, 50)
    closeBtn.MouseButton1Click:Connect(function()
        mainWindow.Visible = false
    end)
    
    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0, 12)
    closeCorner.Parent = closeBtn
    
    -- Content Area
    local contentArea = Instance.new("ScrollingFrame")
    contentArea.Parent = mainWindow
    contentArea.BackgroundTransparency = 1
    contentArea.BorderSizePixel = 0
    contentArea.Position = UDim2.new(0, 15, 0, 65)
    contentArea.Size = UDim2.new(1, -30, 1, -85)
    contentArea.ScrollBarThickness = 5
    contentArea.ScrollBarImageColor3 = Theme.Primary
    
    local layout = Instance.new("UIListLayout")
    layout.Parent = contentArea
    layout.Padding = UDim.new(0, 12)
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    
    -- Status Label
    local statusLabel = Instance.new("TextLabel")
    statusLabel.Parent = mainWindow
    statusLabel.BackgroundTransparency = 1
    statusLabel.TextColor3 = Theme.Success
    statusLabel.TextSize = 14
    statusLabel.Font = Theme.Font
    statusLabel.Text = "рџџў " .. Status
    statusLabel.TextXAlignment = Enum.TextXAlignment.Left
    statusLabel.Position = UDim2.new(0, 15, 1, -25)
    statusLabel.Size = UDim2.new(1, -30, 0, 20)
    
    -- Toggle Window
    local toggled = false
    toggleBtn.MouseButton1Click:Connect(function()
        toggled = not toggled
        mainWindow.Visible = toggled
    end)
    
    -- Dragging
    local dragging = false
    local dragStart
    local startPos
    
    titleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = mainWindow.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            mainWindow.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)
    
    -- Update status display
    game:GetService("RunService").Heartbeat:Connect(function()
        statusLabel.Text = "рџџў " .. Status
    end)
    
    -- Window Methods
    local window = {}
    
    function window:AddToggle(text, default, callback)
        local container = Instance.new("Frame")
        container.Parent = contentArea
        container.BackgroundColor3 = Theme.Secondary
        container.BorderSizePixel = 0
        container.Size = UDim2.new(1, 0, 0, 45)
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = container
        
        local label = Instance.new("TextLabel")
        label.Parent = container
        label.BackgroundTransparency = 1
        label.TextColor3 = Theme.Text
        label.TextSize = 14
        label.Font = Theme.Font
        label.Text = text
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.Position = UDim2.new(0, 15, 0, 0)
        label.Size = UDim2.new(0.7, 0, 1, 0)
        
        local toggle = Instance.new("TextButton")
        toggle.Parent = container
        toggle.Name = text
        toggle.BackgroundColor3 = default and Theme.Success or Theme.Accent
        toggle.TextColor3 = Theme.Text
        toggle.TextSize = 12
        toggle.Font = Theme.Font
        toggle.Text = default and "ON" or "OFF"
        toggle.BorderSizePixel = 0
        toggle.Position = UDim2.new(1, -60, 0.5, -15)
        toggle.Size = UDim2.new(0, 50, 0, 30)
        
        local toggleCorner = Instance.new("UICorner")
        toggleCorner.CornerRadius = UDim.new(0, 6)
        toggleCorner.Parent = toggle
        
        local isOn = default
        
        toggle.MouseButton1Click:Connect(function()
            isOn = not isOn
            toggle.BackgroundColor3 = isOn and Theme.Success or Theme.Accent
            toggle.Text = isOn and "ON" or "OFF"
            callback(isOn)
        end)
        
        return toggle
    end
    
    function window:AddButton(text, callback)
        local button = Instance.new("TextButton")
        button.Parent = contentArea
        button.BackgroundColor3 = Theme.Accent
        button.TextColor3 = Theme.Text
        button.TextSize = 14
        button.Font = Theme.Font
        button.Text = text
        button.BorderSizePixel = 0
        button.Size = UDim2.new(1, 0, 0, 40)
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = button
        
        button.MouseButton1Click:Connect(function()
            local originalColor = button.BackgroundColor3
            button.BackgroundColor3 = Theme.Primary
            task.wait(0.1)
            button.BackgroundColor3 = originalColor
            callback()
        end)
        
        return button
    end
    
    function window:AddLabel(text)
        local label = Instance.new("TextLabel")
        label.Parent = contentArea
        label.BackgroundTransparency = 1
        label.TextColor3 = Theme.TextGray
        label.TextSize = 12
        label.Font = Theme.Font
        label.Text = text
        label.TextWrapped = true
        label.Size = UDim2.new(1, 0, 0, 30)
        
        return label
    end
    
    return window, statusLabel
end

--// ===================== CREATE UI =====================
local window, statusLabel = UILib:CreateWindow("BLOX FRUITS HUB v3.0")

-- Main Tab
window:AddLabel("рџ“‹ AUTO FARM SETTINGS")

window:AddToggle("Auto Farm", false, function(v)
    Config.AutoFarm = v
    if v then SetStatus("Auto Farm Started") else SetStatus("Auto Farm Stopped") end
end)

window:AddToggle("Auto Attack", false, function(v)
    Config.AutoAttack = v
    if v then SetStatus("Auto Attack ON") else SetStatus("Auto Attack OFF") end
end)

window:AddToggle("Player ESP", false, function(v)
    Config.ESP = v
    if v then SetStatus("ESP Enabled") else SetStatus("ESP Disabled") end
end)

window:AddButton("Find NPCs", function()
    local npcs = FindNPCs()
    SetStatus("Found " .. #npcs .. " NPCs")
    print("[INFO] NPCs Found:")
    for i, npc in pairs(npcs) do
        print(i .. ". " .. npc.Name)
    end
end)

window:AddButton("Find Enemies", function()
    local enemies = GetEnemies()
    SetStatus("Found " .. #enemies .. " Enemies")
    print("[INFO] Enemies Found:")
    for i, enemy in pairs(enemies) do
        print(i .. ". " .. enemy.Name)
    end
end)

window:AddLabel("рџ“Ќ TELEPORT")

window:AddButton("Teleport to Closest Enemy", function()
    local enemy, dist = FindClosestEnemy()
    if enemy and enemy:FindFirstChild("HumanoidRootPart") then
        SetStatus("Teleporting to " .. enemy.Name)
        MoveTo(enemy.HumanoidRootPart.CFrame * CFrame.new(0, 0, 5))
    else
        SetStatus("No enemies found!")
    end
end)

window:AddButton("Teleport to Random NPC", function()
    local npcs = FindNPCs()
    if #npcs > 0 then
        local npc = npcs[math.random(1, #npcs)]
        SetStatus("Teleporting to " .. npc.Name)
        MoveTo(npc.HumanoidRootPart.CFrame * CFrame.new(0, 0, 5))
    else
        SetStatus("No NPCs found!")
    end
end)

--// ===================== MAIN LOGIC LOOP =====================
task.spawn(function()
    while true do
        task.wait(0.5)
        
        if Config.AutoAttack then
            Attack()
        end
        
        if Config.AutoFarm then
            local enemy, dist = FindClosestEnemy()
            if enemy and dist < 100 then
                SetStatus("Fighting: " .. enemy.Name .. " (" .. math.floor(dist) .. "m)")
                MoveTo(enemy.HumanoidRootPart.CFrame * CFrame.new(0, 0, 5), Config.Speed)
            else
                SetStatus("Waiting for enemies...")
            end
        end
    end
end)

--// ===================== ESP LOOP =====================
local espObjects = {}

task.spawn(function()
    while true do
        task.wait(0.2)
        
        if Config.ESP then
            local enemies = GetEnemies()
            
            for _, enemy in pairs(enemies) do
                if enemy:FindFirstChild("HumanoidRootPart") and not espObjects[enemy] then
                    -- Create ESP Billboard
                    local billboard = Instance.new("BillboardGui")
                    billboard.Adornee = enemy.HumanoidRootPart
                    billboard.Size = UDim2.new(0, 100, 0, 50)
                    billboard.StudsOffset = Vector3.new(0, 3, 0)
                    billboard.MaxDistance = 1000
                    billboard.Parent = enemy
                    
                    local textLabel = Instance.new("TextLabel")
                    textLabel.Parent = billboard
                    textLabel.BackgroundTransparency = 1
                    textLabel.Size = UDim2.new(1, 0, 1, 0)
                    textLabel.TextColor3 = Theme.Error
                    textLabel.TextSize = 14
                    textLabel.Font = Theme.Font
                    textLabel.TextStrokeTransparency = 0
                    
                    espObjects[enemy] = billboard
                end
                
                if espObjects[enemy] then
                    local dist = math.floor((Player.Character.HumanoidRootPart.Position - enemy.HumanoidRootPart.Position).Magnitude)
                    espObjects[enemy].TextLabel.Text = enemy.Name .. "\n" .. dist .. "m | HP:" .. math.floor(enemy.Humanoid.Health)
                end
            end
        else
            -- Cleanup
            for enemy, billboard in pairs(espObjects) do
                pcall(function() billboard:Destroy() end)
                espObjects[enemy] = nil
            end
        end
    end
end)

print("вњ… Blox Fruits Hub v3.0 loaded!")
print("в„№пёЏ Click в—„в–є button to toggle UI")
print("рџ“ќ Open Developer Console (F9) for debug info")
