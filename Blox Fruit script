local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "LARB HACK v4.0 | Blox Fruits GOD MODE",
    LoadingTitle = "Initializing...",
    LoadingSubtitle = "By VETA",
    ConfigureSaving = {
        Enabled = true,
        FolderName = "LarbHack",
        FileName = "BF_Config"
    },
    Theme = "DarkBlue"
})

-- TABS
local MainTab = Window:CreateTab("Main Farm", 4483362458)
local StatsTab = Window:CreateTab("Auto Stats", 4483362458)
local TeleportTab = Window:CreateTab("Teleport", 4483362458)

-- TAB: TELEPORT
TeleportTab:CreateButton({
    Name = "Teleport to Starter Island",
    Callback = function()
        local npc = workspace.NPCs:FindFirstChild("Bandit Quest Giver")
        if npc then TweenTo(npc.HumanoidRootPart.CFrame) end
    end,
})

TeleportTab:CreateButton({
    Name = "Teleport to Jungle",
    Callback = function()
        local npc = workspace.NPCs:FindFirstChild("Monkey Quest Giver")
        if npc then TweenTo(npc.HumanoidRootPart.CFrame) end
    end,
})

TeleportTab:CreateButton({
    Name = "Teleport to Pirate Village",
    Callback = function()
        local npc = workspace.NPCs:FindFirstChild("Pirate Adventurer")
        if npc then TweenTo(npc.HumanoidRootPart.CFrame) end
    end,
})

TeleportTab:CreateButton({
    Name = "Teleport to Desert",
    Callback = function()
        local npc = workspace.NPCs:FindFirstChild("Desert Adventurer")
        if npc then TweenTo(npc.HumanoidRootPart.CFrame) end
    end,
})

TeleportTab:CreateButton({
    Name = "Teleport to Snow Village",
    Callback = function()
        local npc = workspace.NPCs:FindFirstChild("Snowman")
        if npc then TweenTo(npc.HumanoidRootPart.CFrame) end
    end,
})

TeleportTab:CreateButton({
    Name = "Teleport to Marine Fortress",
    Callback = function()
        local npc = workspace.NPCs:FindFirstChild("Marine Quest Giver")
        if npc then TweenTo(npc.HumanoidRootPart.CFrame) end
    end,
})

TeleportTab:CreateButton({
    Name = "Teleport to Skylands",
    Callback = function()
        local npc = workspace.NPCs:FindFirstChild("Sky Quest Giver")
        if npc then TweenTo(npc.HumanoidRootPart.CFrame) end
    end,
})

local EspTab = Window:CreateTab("ESP & Visuals", 4483362458)
local MiscTab = Window:CreateTab("Misc", 4483362458)

-- VARIABLES
_G.AutoFarm = false
_G.AutoQuest = false
_G.AutoStats = false
_G.SelectedStat = "Melee"
_G.FastAttack = true
_G.MobAura = false
_G.ESP = false
_G.ChestESP = false
_G.FruitESP = false

local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local RS = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local VIM = game:GetService("VirtualInputManager")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- QUEST DATA (EXPANDED)
local QuestData = {
    -- Level 0-10
    {Level = 0, NPC = "Bandit Quest Giver", Mob = "Bandit", QuestName = "BanditQuest1"},
    -- Level 10-15
    {Level = 10, NPC = "Monkey Quest Giver", Mob = "Monkey", QuestName = "JungleQuest"},
    -- Level 15-30
    {Level = 15, NPC = "Gorilla Quest Giver", Mob = "Gorilla", QuestName = "JungleQuest"}, 
    -- Level 30-40
    {Level = 30, NPC = "Pirate Adventurer", Mob = "Pirate", QuestName = "BuggyQuest1"}, 
    -- Level 40-60
    {Level = 40, NPC = "Pirate Adventurer", Mob = "Brute", QuestName = "BuggyQuest1"},
    -- Level 60-75
    {Level = 60, NPC = "Desert Adventurer", Mob = "Desert Bandit", QuestName = "DesertQuest"},
    -- Level 75-90
    {Level = 75, NPC = "Desert Adventurer", Mob = "Desert Officer", QuestName = "DesertQuest"},
    -- Level 90-100
    {Level = 90, NPC = "Snowman", Mob = "Snow Bandit", QuestName = "SnowQuest"},
    -- Level 100-120
    {Level = 100, NPC = "Snowman", Mob = "Snowman", QuestName = "SnowQuest"},
    -- Level 120-150
    {Level = 120, NPC = "Marine Quest Giver", Mob = "Chief Petty Officer", QuestName = "MarineQuest2"},
    -- Level 150-175
    {Level = 150, NPC = "Sky Quest Giver", Mob = "Sky Bandit", QuestName = "SkyQuest"},
    -- Level 175-190
    {Level = 175, NPC = "Sky Quest Giver", Mob = "Dark Master", QuestName = "SkyQuest"},
    -- Level 190-210
    {Level = 190, NPC = "Prisoner Quest Giver", Mob = "Prisoner", QuestName = "PrisonerQuest"},
    -- Level 210-225
    {Level = 210, NPC = "Prisoner Quest Giver", Mob = "Dangerous Prisoner", QuestName = "PrisonerQuest"},
    -- Level 225-250
    {Level = 225, NPC = "Colosseum Quest Giver", Mob = "Toga Warrior", QuestName = "ColosseumQuest"},
    -- Level 250-300
    {Level = 250, NPC = "Colosseum Quest Giver", Mob = "Gladiator", QuestName = "ColosseumQuest"},
    -- Level 300+ (Magma)
    {Level = 300, NPC = "Magma Quest Giver", Mob = "Military Soldier", QuestName = "MagmaQuest"},
}

-- UTILITIES
local function GetLevel()
    return Player.Data.Level.Value
end

local function GetCurrentQuestData()
    local lvl = GetLevel()
    local best = nil
    for _, q in ipairs(QuestData) do
        if lvl >= q.Level then
            best = q
        end
    end
    return best
end

local function TweenTo(cframe)
    if not Player.Character or not Player.Character:FindFirstChild("HumanoidRootPart") then return end
    local dist = (Player.Character.HumanoidRootPart.Position - cframe.Position).Magnitude
    local info = TweenInfo.new(dist / 300, Enum.EasingStyle.Linear) -- Speed 300
    local tween = TweenService:Create(Player.Character.HumanoidRootPart, info, {CFrame = cframe})
    tween:Play()
    
    -- Anti-Kick / Float
    if not Player.Character.HumanoidRootPart:FindFirstChild("BodyVelocity") then
        local bv = Instance.new("BodyVelocity")
        bv.Velocity = Vector3.new(0,0,0)
        bv.MaxForce = Vector3.new(100000,100000,100000)
        bv.Parent = Player.Character.HumanoidRootPart
        
        tween.Completed:Connect(function()
            bv:Destroy()
        end)
    end
    
    return tween
end

local function Attack()
    pcall(function()
        local Combat = require(Player.PlayerScripts.CombatFramework)
        local Cemara = require(Player.PlayerScripts.CombatFramework.CameraShaker)
        Cemara.CameraShakeInstance.CameraShakeState = {FadingIn = 3, FadingOut = 2, Sustained = 0, Inactive = 1}
        Combat.activeController.hitboxMagnitude = 60
        game:GetService("VirtualUser"):CaptureController()
        game:GetService("VirtualUser"):ClickButton1(Vector2.new(851, 158), game:GetService("Workspace").Camera.CFrame)
    end)
end

-- MAIN FARM LOOP
task.spawn(function()
    while true do
        task.wait()
        if _G.AutoFarm then
            pcall(function()
                local quest = GetCurrentQuestData()
                if not quest then return end
                
                -- 1. Check if we have quest
                local myQuest = Player.PlayerGui.Main.Quest
                if not myQuest.Visible then
                    -- Go take quest
                    local npc = workspace.NPCs:FindFirstChild(quest.NPC)
                    if npc then
                        if (Player.Character.HumanoidRootPart.Position - npc.HumanoidRootPart.Position).Magnitude > 10 then
                            TweenTo(npc.HumanoidRootPart.CFrame * CFrame.new(0,0,3))
                        else
                            -- Interact
                            fireclickdetector(npc.ClickDetector)
                            -- Try Remote if Interact fails (Basic Remote implementation)
                            game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("StartQuest", quest.QuestName, 1)
                        end
                    end
                else
                    -- 2. Farm Mobs
                    local enemyName = quest.Mob
                    local enemy = nil
                    
                    -- Find closest enemy
                    for _, v in pairs(workspace.Enemies:GetChildren()) do
                        if v.Name == enemyName and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 then
                            enemy = v
                            break
                        end
                    end
                    
                    if enemy then
                        enemy.HumanoidRootPart.CanCollide = false
                        enemy.Humanoid.WalkSpeed = 0
                        
                        -- Tween to enemy (Above)
                        local farmPos = enemy.HumanoidRootPart.CFrame * CFrame.new(0, 7, 0) * CFrame.Angles(math.rad(-90), 0, 0)
                        TweenTo(farmPos)
                        
                        -- Attack
                        if (Player.Character.HumanoidRootPart.Position - enemy.HumanoidRootPart.Position).Magnitude < 20 then
                            if _G.FastAttack then
                                Attack()
                            else
                                VIM:SendKeyEvent(true, Enum.KeyCode.Z, false, game) -- Basic skill
                                VIM:SendMouseButtonEvent(0, 0, 0, true, game, 1) -- Click
                                task.wait(0.1)
                                VIM:SendMouseButtonEvent(0, 0, 0, false, game, 1)
                            end
                        end
                    else
                        -- No enemy found, wait for spawn
                        -- Optional: Teleport to spawn area
                    end
                end
            end)
        end
    end
end)

-- AUTO STATS LOOP
task.spawn(function()
    while true do
        task.wait(0.5)
        if _G.AutoStats then
            game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("AddPoint", _G.SelectedStat, 1)
        end
    end
end)

-- ESP FUNCTION
local function UpdateESP()
    for _, v in pairs(workspace:GetChildren()) do
        if _G.ChestESP and v.Name:find("Chest") then
            if not v:FindFirstChild("ESP") then
                local h = Instance.new("Highlight", v)
                h.Name = "ESP"
                h.FillColor = Color3.new(1,1,0)
            end
        end
        if _G.FruitESP and v.Name:find("Fruit") and v:IsA("Tool") then -- Dropped fruit
             if not v:FindFirstChild("ESP") then
                local h = Instance.new("Highlight", v)
                h.Name = "ESP"
                h.FillColor = Color3.new(1,0,0)
            end
        end
    end
    
    for _, p in pairs(Players:GetPlayers()) do
        if _G.ESP and p ~= Player and p.Character then
             if not p.Character:FindFirstChild("ESP") then
                local h = Instance.new("Highlight", p.Character)
                h.Name = "ESP"
                h.FillColor = Color3.new(0,1,0)
            end
        end
    end
end

task.spawn(function()
    while true do
        task.wait(1)
        UpdateESP()
    end
end)

-- ========== GUI SETUP ==========

-- TAB: MAIN FARM
MainTab:CreateToggle({
    Name = "Enable Auto Farm",
    CurrentValue = false,
    Callback = function(Value)
        _G.AutoFarm = Value
    end,
})

MainTab:CreateToggle({
    Name = "Fast Attack (Laggy)",
    CurrentValue = true,
    Callback = function(Value)
        _G.FastAttack = Value
    end,
})

-- TAB: STATS
StatsTab:CreateDropdown({
    Name = "Select Stat",
    Options = {"Melee", "Defense", "Sword", "Gun", "Demon Fruit"},
    CurrentOption = "Melee",
    Callback = function(Value)
        _G.SelectedStat = Value
    end,
})

StatsTab:CreateToggle({
    Name = "Auto Upgrade Stat",
    CurrentValue = false,
    Callback = function(Value)
        _G.AutoStats = Value
    end,
})

-- TAB: ESP
EspTab:CreateToggle({
    Name = "Player ESP",
    CurrentValue = false,
    Callback = function(Value)
        _G.ESP = Value
    end,
})

EspTab:CreateToggle({
    Name = "Chest ESP",
    CurrentValue = false,
    Callback = function(Value)
        _G.ChestESP = Value
    end,
})

EspTab:CreateToggle({
    Name = "Fruit ESP",
    CurrentValue = false,
    Callback = function(Value)
        _G.FruitESP = Value
    end,
})

-- TAB: MISC
MiscTab:CreateButton({
    Name = "Rejoin Server",
    Callback = function()
        game:GetService("TeleportService"):Teleport(game.PlaceId, Player)
    end,
})

Window:CreateLabel("Updated by AI Assistant - v4.0")
Rayfield:LoadConfiguration()
