--[[
    Erafox: Universal Scanner v5.2 (Mobile Fix)
    
    –ò–ó–ú–ï–ù–ï–ù–ò–Ø v5.2:
    1. –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–£–°–¢–´–• –°–ü–ò–°–ö–û–í: –î–æ–±–∞–≤–ª–µ–Ω —Ä—É—á–Ω–æ–π –ø–µ—Ä–µ—Å—á–µ—Ç CanvasSize (AutomaticCanvasSize –≥–ª—é—á–∏—Ç –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö).
    2. –ö–ù–û–ü–ö–ò: –¢–∞–±—ã —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç UIListLayout, —á—Ç–æ–±—ã –Ω–µ —Å–ª–∏–ø–∞–ª–∏—Å—å.
    3. –†–ê–ó–ú–ï–†: –≠–ª–µ–º–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–∞ —É–≤–µ–ª–∏—á–µ–Ω—ã (60px) –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è –ø–∞–ª—å—Ü–µ–º.
    4. –¢–ï–ö–°–¢: –í–µ—Å—å —Ç–µ–∫—Å—Ç —Ç–µ–ø–µ—Ä—å –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è (TextScaled), —á—Ç–æ–±—ã –≤–ª–µ–∑–∞—Ç—å –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏–µ —ç–∫—Ä–∞–Ω—ã.
    5. GUI: ResetOnSpawn = false, —á—Ç–æ–±—ã –º–µ–Ω—é –Ω–µ –ø—Ä–æ–ø–∞–¥–∞–ª–æ –ø–æ—Å–ª–µ —Å–º–µ—Ä—Ç–∏.
]]

local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Workspace = game:GetService("Workspace")

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏
local Config = {
    Theme = {
        Main = Color3.fromRGB(25, 25, 35),
        Secondary = Color3.fromRGB(35, 35, 45),
        Accent = Color3.fromRGB(255, 140, 0), -- –û—Ä–∞–Ω–∂–µ–≤—ã–π (Fox)
        Text = Color3.fromRGB(240, 240, 240),
        Success = Color3.fromRGB(100, 255, 100),
        Error = Color3.fromRGB(255, 100, 100)
    },
    IsMobile = UserInputService.TouchEnabled
}

-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ UI
local UI = {}

function UI.Create(className, properties, children)
    local instance = Instance.new(className)
    for k, v in pairs(properties or {}) do
        instance[k] = v
    end
    for _, child in pairs(children or {}) do
        child.Parent = instance
    end
    return instance
end

-- –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–æ–¥–∏—Ç–µ–ª—è –¥–ª—è GUI (Cross-Executor Support)
local function GetGuiParent()
    -- 1. –ü—Ä–æ–±—É–µ–º gethui (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç)
    if gethui then 
        return gethui() 
    end
    
    -- 2. –ü—Ä–æ–±—É–µ–º CoreGui (–µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∞–≤–∞)
    local success, result = pcall(function() return game:GetService("CoreGui") end)
    if success and result then 
        return result 
    end
    
    -- 3. –§–æ–ª–±—ç–∫ –Ω–∞ PlayerGui
    local playerGui = LocalPlayer:WaitForChild("PlayerGui", 5)
    if playerGui then
        return playerGui
    end
    
    return LocalPlayer:WaitForChild("PlayerGui")
end

-- –°–æ–∑–¥–∞–Ω–∏–µ ScreenGui
local ParentTarget = GetGuiParent()
print("Erafox: GUI Parent set to " .. tostring(ParentTarget))

-- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é –µ—Å–ª–∏ –µ—Å—Ç—å
for _, child in pairs(ParentTarget:GetChildren()) do
    if child.Name == "ErafoxScannerV5" then child:Destroy() end
end

local ScreenGui = UI.Create("ScreenGui", {
    Name = "ErafoxScannerV5",
    Parent = ParentTarget,
    ResetOnSpawn = false, -- –í–ê–ñ–ù–û: –ù–µ —É–¥–∞–ª—è—Ç—å –ø—Ä–∏ —Ä–µ—Å–ø–∞–≤–Ω–µ
    ZIndexBehavior = Enum.ZIndexBehavior.Sibling
})

-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è (–ë–û–õ–¨–®–ê–Ø –ò –ó–ê–ú–ï–¢–ù–ê–Ø)
local OpenBtn = UI.Create("TextButton", {
    Name = "ErafoxOpen",
    Text = "ü¶ä",
    Size = UDim2.new(0, 60, 0, 60), -- –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –ø–∞–ª—å—Ü–µ–≤
    Position = UDim2.new(0, 20, 0.4, 0),
    BackgroundColor3 = Config.Theme.Main,
    TextColor3 = Config.Theme.Accent,
    TextScaled = true,
    Parent = ScreenGui,
    ZIndex = 100 -- –í—Å–µ–≥–¥–∞ —Å–≤–µ—Ä—Ö—É
}, {
    UI.Create("UICorner", {CornerRadius = UDim.new(1, 0)}),
    UI.Create("UIStroke", {Color = Config.Theme.Accent, Thickness = 2})
})

-- –ì–ª–∞–≤–Ω–æ–µ –æ–∫–Ω–æ
local MainWindow = UI.Create("Frame", {
    Name = "MainWindow",
    Size = Config.IsMobile and UDim2.new(0.95, 0, 0.8, 0) or UDim2.new(0.5, 0, 0.6, 0),
    Position = UDim2.new(0.5, 0, 0.5, 0),
    AnchorPoint = Vector2.new(0.5, 0.5),
    BackgroundColor3 = Config.Theme.Main,
    BorderSizePixel = 0,
    Visible = false, -- –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    Parent = ScreenGui,
    ClipsDescendants = true
}, {
    UI.Create("UICorner", {CornerRadius = UDim.new(0, 10)})
})

-- –ó–∞–≥–æ–ª–æ–≤–æ–∫
local TopBar = UI.Create("Frame", {
    Size = UDim2.new(1, 0, 0, 40),
    BackgroundColor3 = Config.Theme.Secondary,
    Parent = MainWindow
}, {
    UI.Create("UICorner", {CornerRadius = UDim.new(0, 10)}),
    UI.Create("TextLabel", {
        Text = "  Erafox Scanner v5.2",
        Size = UDim2.new(0.8, 0, 1, 0),
        BackgroundTransparency = 1,
        TextColor3 = Config.Theme.Accent,
        TextSize = 18,
        Font = Enum.Font.GothamBold,
        TextXAlignment = Enum.TextXAlignment.Left
    }),
    UI.Create("TextButton", {
        Text = "X",
        Size = UDim2.new(0, 40, 0, 40),
        Position = UDim2.new(1, -40, 0, 0),
        BackgroundTransparency = 1,
        TextColor3 = Config.Theme.Error,
        TextSize = 20,
        Font = Enum.Font.GothamBold
    })
})

-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–∫–ª–∞–¥–æ–∫
local TabContainer = UI.Create("Frame", {
    Size = UDim2.new(1, 0, 0, 45), -- –ß—É—Ç—å –≤—ã—à–µ –¥–ª—è –º–æ–±–∏–ª–æ–∫
    Position = UDim2.new(0, 0, 0, 40),
    BackgroundColor3 = Config.Theme.Main,
    Parent = MainWindow
}, {
    UI.Create("UIListLayout", {
        FillDirection = Enum.FillDirection.Horizontal,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 0)
    })
})

-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
local ContentContainer = UI.Create("Frame", {
    Size = UDim2.new(1, 0, 1, -85),
    Position = UDim2.new(0, 0, 0, 85),
    BackgroundTransparency = 1,
    Parent = MainWindow
})

-- –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
local CurrentTab = nil
local Tabs = {}

local function SwitchTab(tabName)
    if CurrentTab then CurrentTab.Frame.Visible = false end
    if Tabs[tabName] then
        Tabs[tabName].Frame.Visible = true
        CurrentTab = Tabs[tabName]
    end
end

local function CreateTab(name, icon, layoutOrder)
    -- –ö–Ω–æ–ø–∫–∞ –≤–∫–ª–∞–¥–∫–∏
    local tabBtn = UI.Create("TextButton", {
        Text = icon .. " " .. name,
        Size = UDim2.new(0.2, 0, 1, 0), -- 5 –≤–∫–ª–∞–¥–æ–∫ = 20% –∫–∞–∂–¥–∞—è
        BackgroundColor3 = Config.Theme.Secondary,
        BackgroundTransparency = 0.5,
        TextColor3 = Config.Theme.Text,
        TextScaled = true, -- –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
        Font = Enum.Font.Gotham,
        Parent = TabContainer,
        LayoutOrder = layoutOrder
    })

    -- –§—Ä–µ–π–º –≤–∫–ª–∞–¥–∫–∏
    local tabFrame = UI.Create("ScrollingFrame", {
        Size = UDim2.new(1, -10, 1, -10),
        Position = UDim2.new(0, 5, 0, 5),
        BackgroundTransparency = 1,
        ScrollBarThickness = 6,
        Visible = false,
        Parent = ContentContainer,
        -- –í–ê–ñ–ù–û: –û—Ç–∫–ª—é—á–∞–µ–º AutomaticCanvasSize, —Å—á–∏—Ç–∞–µ–º —Å–∞–º–∏
        CanvasSize = UDim2.new(0, 0, 0, 0) 
    }, {
        UI.Create("UIListLayout", {
            SortOrder = Enum.SortOrder.LayoutOrder,
            Padding = UDim.new(0, 5)
        })
    })

    Tabs[name] = {Button = tabBtn, Frame = tabFrame, Count = 0}

    tabBtn.MouseButton1Click:Connect(function()
        SwitchTab(name)
    end)
    
    return tabFrame
end

-- –°–æ–∑–¥–∞–µ–º –≤–∫–ª–∞–¥–∫–∏
local ExplorerTab = CreateTab("Explorer", "üìÅ", 1)
local RemoteTab = CreateTab("Remotes", "üì°", 2)
local PlayersTab = CreateTab("Players", "üë§", 3)
local WorldTab = CreateTab("World", "üåç", 4)
local SettingsTab = CreateTab("Settings", "‚öôÔ∏è", 5)

-- –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–ø–∏—Å–∫–∞ (–£–õ–£–ß–®–ï–ù–ù–ê–Ø)
local function CreateListItem(parent, title, desc, color, actionText, actionFunc)
    -- –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫
    local layout = parent:FindFirstChild("UIListLayout")
    
    local item = UI.Create("Frame", {
        Size = UDim2.new(1, 0, 0, 60), -- –£–≤–µ–ª–∏—á–µ–Ω–æ –¥–æ 60px –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
        BackgroundColor3 = Config.Theme.Secondary,
        Parent = parent
    }, {
        UI.Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
        UI.Create("Frame", { -- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ü–≤–µ—Ç–∞
            Size = UDim2.new(0, 5, 1, 0),
            BackgroundColor3 = color or Config.Theme.Text,
            Parent = item
        }, {UI.Create("UICorner", {CornerRadius = UDim.new(0, 4)})}),
        
        UI.Create("TextLabel", { -- –ó–∞–≥–æ–ª–æ–≤–æ–∫
            Text = title,
            Size = UDim2.new(0.65, -15, 0.5, 0),
            Position = UDim2.new(0, 15, 0, 5),
            BackgroundTransparency = 1,
            TextColor3 = Config.Theme.Text,
            TextScaled = true,
            Font = Enum.Font.GothamBold,
            TextXAlignment = Enum.TextXAlignment.Left
        }),
        
        UI.Create("TextLabel", { -- –û–ø–∏—Å–∞–Ω–∏–µ
            Text = desc,
            Size = UDim2.new(0.65, -15, 0.4, 0),
            Position = UDim2.new(0, 15, 0.5, 0),
            BackgroundTransparency = 1,
            TextColor3 = Color3.fromRGB(150, 150, 150),
            TextScaled = true,
            Font = Enum.Font.Gotham,
            TextXAlignment = Enum.TextXAlignment.Left
        })
    })
    
    if actionText and actionFunc then
        local btn = UI.Create("TextButton", {
            Text = actionText,
            Size = UDim2.new(0.3, 0, 0.8, 0),
            Position = UDim2.new(0.68, 0, 0.1, 0),
            BackgroundColor3 = Config.Theme.Main,
            TextColor3 = Config.Theme.Accent,
            TextScaled = true,
            Font = Enum.Font.GothamBold,
            Parent = item
        }, {UI.Create("UICorner", {CornerRadius = UDim.new(0, 6)})})
        
        btn.MouseButton1Click:Connect(actionFunc)
    end
    
    -- –í–†–£–ß–ù–£–Æ –æ–±–Ω–æ–≤–ª—è–µ–º CanvasSize
    local childCount = #parent:GetChildren() - 1 -- –≤—ã—á–∏—Ç–∞–µ–º layout
    local newHeight = childCount * 65 -- 60px item + 5px padding
    parent.CanvasSize = UDim2.new(0, 0, 0, newHeight)
    
    return item
end

-- === –§–£–ù–ö–¶–ò–û–ù–ê–õ ===

-- 1. Explorer (–§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä)
local CurrentPath = game
local function RefreshExplorer()
    ExplorerTab:ClearAllChildren()
    UI.Create("UIListLayout", {SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 5)}, {Parent = ExplorerTab})
    
    -- –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
    if CurrentPath ~= game then
        CreateListItem(ExplorerTab, "..", "Go Back", Config.Theme.Accent, "Back", function()
            if CurrentPath.Parent then
                CurrentPath = CurrentPath.Parent
                RefreshExplorer()
            end
        end)
    end
    
    -- –°–∫–∞–Ω–∏—Ä—É–µ–º –¥–µ—Ç–µ–π (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
    local children = {}
    pcall(function() children = CurrentPath:GetChildren() end)
    
    for _, child in pairs(children) do
        CreateListItem(ExplorerTab, child.Name, child.ClassName, Config.Theme.Text, "Open", function()
            CurrentPath = child
            RefreshExplorer()
        end)
    end
    
    -- –ï—Å–ª–∏ –ø—É—Å—Ç–æ
    if #children == 0 then
         CreateListItem(ExplorerTab, "Empty", "No children found", Config.Theme.Error, nil, nil)
    end
end

-- 2. Remotes Scanner
local function ScanRemotes()
    RemoteTab:ClearAllChildren()
    UI.Create("UIListLayout", {SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 5)}, {Parent = RemoteTab})
    
    local function SafeGetDescendants(obj)
        local objects = {}
        pcall(function() objects = obj:GetDescendants() end)
        return objects
    end
    
    local count = 0
    local targets = {Workspace, game:GetService("ReplicatedStorage"), game:GetService("Players")}
    
    for _, service in pairs(targets) do
        for _, v in pairs(SafeGetDescendants(service)) do
            if v:IsA("RemoteEvent") or v:IsA("RemoteFunction") then
                count = count + 1
                CreateListItem(RemoteTab, v.Name, v.ClassName .. " | " .. (v.Parent and v.Parent.Name or "No Parent"), Config.Theme.Success, "Copy Path", function()
                    if setclipboard then
                        setclipboard(v:GetFullName())
                    end
                end)
            end
        end
    end
    
    if count == 0 then
        CreateListItem(RemoteTab, "No Remotes", "Scan found nothing", Config.Theme.Error)
    end
end

-- 3. Players Scanner
local function ScanPlayers()
    PlayersTab:ClearAllChildren()
    UI.Create("UIListLayout", {SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 5)}, {Parent = PlayersTab})
    
    for _, plr in pairs(Players:GetPlayers()) do
        local desc = "Health: ?"
        if plr.Character and plr.Character:FindFirstChild("Humanoid") then
            desc = "Health: " .. math.floor(plr.Character.Humanoid.Health)
        end
        
        CreateListItem(PlayersTab, plr.Name, desc, Config.Theme.Accent, "Teleport", function()
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                LocalPlayer.Character.HumanoidRootPart.CFrame = plr.Character.HumanoidRootPart.CFrame
            end
        end)
    end
end

-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
TopBar:WaitForChild("TextButton").MouseButton1Click:Connect(function()
    MainWindow.Visible = false
    OpenBtn.Visible = true
end)

OpenBtn.MouseButton1Click:Connect(function()
    MainWindow.Visible = not MainWindow.Visible
    -- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
    if MainWindow.Visible then
        RefreshExplorer()
        ScanRemotes()
        ScanPlayers()
    end
end)

-- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –∫–Ω–æ–ø–∫–∏
local dragging, dragInput, dragStart, startPos
OpenBtn.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = OpenBtn.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

OpenBtn.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        OpenBtn.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- –ó–∞–ø—É—Å–∫
SwitchTab("Explorer")
print("Erafox Scanner v5.2 Loaded Successfully!")
